<!-- templates/clustering.html -->

{% extends "base.html" %}

{% block title %}Clustering Example - Customer Segmentation{% endblock %}

{% block content %}
    <h2 class="text-center my-4">Customer Segmentation</h2>
    <div id="cluster-plot"></div>
{% endblock %}

{% block scripts %}
    <!-- Include Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript">
        // Data passed from Flask
        var data = {{ data | tojson | safe }};

        // Prepare data for Plotly
        var clusters = {};

        data.forEach(function(row) {
            var cluster = row.Cluster;
            if (!clusters[cluster]) {
                clusters[cluster] = {
                    x: [],
                    y: [],
                    mode: 'markers',
                    type: 'scatter',
                    name: 'Cluster ' + cluster,
                    marker: { size: 12 }
                };
            }
            clusters[cluster].x.push(row.AnnualIncome);
            clusters[cluster].y.push(row.SpendingScore);
        });

        var traces = Object.values(clusters);

        var layout = {
            title: 'Customer Segmentation',
            xaxis: { title: 'Annual Income (k$)' },
            yaxis: { title: 'Spending Score (1-100)' },
            hovermode: 'closest',
            font: { family: 'Arial, sans-serif', size: 12 },
            margin: { l: 50, r: 50, t: 50, b: 50 },
        };

        Plotly.newPlot('cluster-plot', traces, layout, {responsive: true});
    </script>
{% endblock %}
